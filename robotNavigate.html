
<!doctype html>
<html>

<head>
	<style type="text/css">
		html, body {
			padding: 0;
			margin: 0;
			height: 100%;
		}
		canvas {
			position: absolute;
			
			width: 100%;
			height: 100%;
		}
		#fieldImg { 
			width: 100%;
			height: "auto";
		}
		#robot {
			width: 40px;
			height: 40px;
			pointer-events: none;
			-webkit-pointer-events: none;
		}
	
	</style>

</head>
<body>
<canvas id="DrawingBoard"></canvas>
<canvas id="ImageCanvas"></canvas>
<br>
<img id="fieldImg" src="steamworksField.png"></img>
<img id="robot" src="spaceship.png" style="position:relative"></img>
<button id="clear" style="top:0px;left:0px;width:50px;height:30px;position:absolute">Clear</button>
<button id="save" style="top:0px;left:50px;width:50px;height:30px;position:absolute">Save</button>
<canvas class="canvas" id="DrawingBoard"></canvas>

<script>

	var robotX = 0;
	var robotY = 0;
	var oldX;
	var oldY;
	var currentRotation = 90;
	var clearbtn = document.getElementById("clear");
	var savebtn = document.getElementById("save");
	var fieldImg = document.getElementById("fieldImg");
	var robotImg = document.getElementById("robot");
	var canvas = document.getElementById("DrawingBoard");
	var context = canvas.getContext("2d");
	var nextPointX = 1;
	var nextPointY = 1;
	clearbtn.style.zIndex = "3";
	savebtn.style.zIndex = "3";
	canvas.style.zIndex = "2";
	fieldImg.style.display = "none";
	robotImg.style.zIndex = "4";
	var drawing;
	var lifted = false;
	clearbtn.onclick = function(){
		context.clearRect(0,0,canvas.width,canvas.height);
		drawing = false;
		lifted = false;
		//fieldImg.style.width = '100%';
		//fieldImg.style.height = '100%';
		context.drawImage(fieldImg, 0, 0, canvas.width, canvas.width * fieldImg.height/fieldImg.width);
	}
	savebtn.onclick = function(){

	}

	
	window.onload = window.onresize = function(){
		canvas.width = canvas.offsetWidth;
		canvas.height = canvas.offsetHeight;
		//imgCanvas.width = 5;
		//imgCanvas.height = 5;
		//fieldImg.style.width = '100%';
		//fieldImg.style.height = '100%';
		context.drawImage(fieldImg, 0, 0, canvas.width, canvas.width * fieldImg.height/fieldImg.width);
		//robotX = 0;
		//robotY = 0;
		placeRobotOnField(0,0);
	}
	function circ(x,y,radius,color){
		context.beginPath();
		context.arc(x,y,radius,0,Math.PI*2);
		context.fillStyle = color;
		context.fill();
		context.closePath();
	}
	function line(x,y,newx,newy){
		context.beginPath();
		context.moveTo(x,y);
		context.lineTo(newx,newy);
		context.stroke();
	}

	/*imgCanvas.onpointerdown = function(event) {
		console.log(event.button);
		/*if (event.button != 2 && !lifted) {
			event.preventDefault();
			drawing = true;
			oldx = event.clientX;
			oldy = event.clientY;
		}
		event.preventDefault();
		newRobot(event.clientX,event.clientY);
	}*/
	
	canvas.onpointerdown = function(event) {
		console.log(event.button);
		/*if (event.button != 2 && !lifted) {
			event.preventDefault();
			drawing = true;
			oldx = event.clientX;
			oldy = event.clientY;
		}*/
		event.preventDefault();
		//newRobot(event.clientX,event.clientY);
		setNextControlPoint(event.clientX - 20, event.clientY - 30);
	}

	canvas.onpointerup = function(event) {
		if (event.button != 2) {
			event.preventDefault();
			drawing = false;
			lifted = true;
		}
	}

 	var posx, posy;
 	var oldx = 0,oldy = 0;
	canvas.onpointermove = function(event) {
		if (event.button != 2) {
			event.preventDefault();
			posx = event.clientX;
			posy = event.clientY;
		}
	}

	function draw(){
		if (drawing){
			line(oldx,oldy,posx,posy)
			oldx = posx;
			oldy = posy;
			console.log(posy);
		}
		setTimeout(draw,0)
	}

	function newRobot(posx, posy) {
		//robotY = (posy - 30);
		//robotX = (posx - 20);
		//robotImg.style.transform = 'rotate(' + (Math.random()*180) + 'deg)';
	}

	function getX(){
		return Math.random()*canvas.width;
	}
	function getY(){
		return Math.random()*canvas.height;
	}
	function getRotation(){
		return Math.random*360;
	}
	var xPos = 0;
	var turnAngle;
	function showRobot(){

		if(nextPointY -robotY >= 0) {
			turnAngle = Math.acos((nextPointX - robotX) / Math.sqrt(Math.pow((nextPointX -robotX), 2) + 
			Math.pow((nextPointY - robotY), 2)))*180/Math.PI;
		}
		else {
			turnAngle = Math.acos((nextPointX - robotX) / Math.sqrt(Math.pow((nextPointX - robotX), 2) + 
			Math.pow((nextPointY - robotY), 2)))*-180/Math.PI;
		}
		
		robotImg.style.transform = 'rotate(' + (turnAngle) + 'deg)';
		moveForward();
		//console.log(getX());
		//console.log(getX());
		xPos += 1;
		setTimeout(showRobot, 0);
	}

	function setNextControlPoint(xPos, yPos) {
		nextPointX = xPos;
		nextPointY = yPos;
	}
	function moveForward() {
		robotX = robotX + Math.cos((90-turnAngle)*Math.PI/180) * 10;
		robotY = robotY + Math.sin((90-turnAngle)*Math.PI/180) * 10;
		robotImg.style.top = robotY + "px";
		robotImg.style.left = robotX + "px";
		//console.log(robotX);
		//console.log(robotY);
	}
	
	function placeRobotOnField(posX, posY) {
		robotX = ???;
		robotY = ???;
		robotImg.style.left = robotX + "px";
		robotImg.style.top = robotY + "px";
	}
	//showRobot();
	// var dataURL = canvas.toDataURL();
 //    document.getElementById('canvasImg').src = dataURL;


		
</script>


</body></html>